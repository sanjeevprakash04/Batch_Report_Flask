{% extends 'base.html' %}

{% block content %}
<div class="inv-navbar">
    <div class="inv-navbar-left">
        <span class="inv-app-title">Settings</span>
    </div>
</div>

<div class="settings-content">

    <div class="upper">

        {% if role in ['admin', 'superadmin'] %}
        <div class="upper-left">
            <span style="padding:0.65rem 0.6rem; background:#005da2;color:white;">General Settings</span>

            <div class="top">
                <span>Enter Email ID</span>
                <input type="email" style="margin-left:1.3rem" placeholder="Enter Email ID">
                <button style="margin-left:1rem;">Set Email</button>
            </div>

            <div class="bottom">
                <span>Report Name</span>
                <input type="text" id="reportNameInput" style="margin-left:1.7rem" placeholder="Enter Report Name">
                
                <!-- Hidden file input for logo -->
                <input type="file" id="logoFileInput" accept="image/*" hidden>

                <button id="setReportNameBtn" style="margin-left:1rem;">Set Name</button>
            </div>

        </div>
        {% endif %}

        {% if role == 'superadmin' %}
        <div class="upper-right">
            <span style="padding:0.65rem 0.6rem;background:#005da2;color:white;">Configure Connection</span>

            <div class="top">
                <span>Select Connection Driver</span>
                <select class="settings-select" style="margin-left:8rem;">
                    <option>Siemens</option>
                    <option>Rockwell</option>
                </select>
            </div>

            <div class="bottom">
                <span>Specify Node / Station IP</span>
                <input type="text" style="margin-left:0.5rem" placeholder="Enter IP Address">
            </div>
        </div>
        {% endif %}

    </div>

    <div class="lower">

        {% if role in ['admin', 'superadmin'] %}
        <div class="lower-left">
            <span style="padding:0.65rem 0.6rem;background:#005da2;color:white;">Database Backup</span>
            <div class="one">
                <span>Save Database Backup</span>
                <button style="margin-left:13.8rem;">Save</button>
            </div>
        </div>
        {% endif %}
        {% if role == 'superadmin' %}
        
        <div class="lower-right">
            <span style="padding:0.65rem 0.6rem;background:#005da2;color:white;">Configure Data</span>

            <div class="top">
                <span>Upload PLC DB Configuration</span>
                <button style="margin-left:8.4rem;">Upload</button>
                <input type="file" hidden>
            </div>

            <div class="bottom">
                <span>Download PLC DB Configuration</span>
                <button style="margin-left:2rem;">Download</button>
            </div>

        </div>
        {% endif %}

    </div>
    <div class="bottom-content">
        
    </div>

</div>

<script>
document.getElementById("setReportNameBtn").addEventListener("click", async () => {
    
    const nameInput = document.getElementById("reportNameInput").value.trim();

    // Ask if user wants to upload logo image
    const uploadLogo = confirm("Do you want to upload a logo image?");

    let formData = new FormData();
    formData.append("report_name", nameInput);

    if (uploadLogo) {
        document.getElementById("logoFileInput").click();

        document.getElementById("logoFileInput").onchange = async () => {
            const file = document.getElementById("logoFileInput").files[0];
            if (file) {
                formData.append("logo", file);
            }
            await sendUpdateRequest(formData);
        };
    } else {
        await sendUpdateRequest(formData);
    }
});

async function sendUpdateRequest(formData) {
    const res = await fetch("/api/settings/update_report", {
        method: "POST",
        body: formData
    });

    const result = await res.json();

    if (result.success) {
        alert("Updated Successfully!");
    } else {
        alert("Error: " + result.error);
    }
}
</script>

{% endblock %}
